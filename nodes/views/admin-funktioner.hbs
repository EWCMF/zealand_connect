<div class="container-fluid">
    <div class="row">
        <h1 style="padding-left: 16px;" data-key="adminFunktion">Administrator funktioner</h1>
    </div>
    <div class="row justify-content-center " style="padding-left: 16px;padding-right: 22px;">
        <div class="col-6" style="border-right-style: solid; border-width: 1px;">
            <div class="row p-3">
                <h2 style="font-weight: bold;" data-key="opretUddannelse">Opret Uddannelse</h2>
            </div>
            <form action="" class="form-group text-left">
                <div class="row">
                    <label for="opretUddannelse" class="col-5 col-form-label">Uddannelse</label>
                </div>
                <div class="form-group row">
                    <div class="col-12">
                        <input type="text" id="uddannelseOpretInput" class="form-control" placeholder="Uddannelse eksempel" style="background-color: #f7f7f7;">
                    </div>
                </div>
                <button class="gulKnap rounded" type="button" id="opretUddannelse-btn" data-key="opret">Opret</button>
                
            </form>
            <div class="row p-3">
                <h2 style="font-weight: bold;" data-key="sletUddannelse">Slet Uddanelse</h2>
            </div>
            <form action="" class="form-group text-left">
                <div class="row">
                    <label for="opretUddannelse" class="col-5 col-form-label" data-key="uddannelse">Uddannelse</label>
                </div>
                <div class="form-group row">
                    <div class="col-12">
                        <input id="uddannelseSletInput" type="text" class="form-control" placeholder="Uddannelse eksempel" style="background-color: #f7f7f7;">
                    </div>
                </div>
                <button class="gulKnap rounded" type="button" id="sletUddannelse-btn" data-key="slet">Slet</button>
            </form>
        </div>
        <div class="col-6">
            <div class="row p-3">
                <h2 style="font-weight: bold;" data-key="sletBruger">Slet student</h2>
            </div>
            <form class="form-group text-left sletBrugerForm" onsubmit="return false">
                <div>
                    <div class="formError float-left" id="student-error"></div><br>
                </div>
                <div class="row col-12">
                    <label for="email" class="col-form-label">Email</label>
                </div>
                <div class="form-group row">
                    <div class="col-12">
                        <input name="email" type="text" id="studentSletEmailInput" class="form-control" placeholder="example@edu.easj.dk" style="background-color: #f7f7f7;" required oninvalid="this.setCustomValidity('Feltet må ikke være tomt')" oninput="this.setCustomValidity('')">
                    </div> 
                </div>
                <input class="gulKnap rounded" onclick="submitSletStudent()" type="submit" data-key="slet" value="Slet">
                <input id="submit_handle_student" type="submit" style="display: none">
            </form>
            <div class="row p-3">
                <h2 style="font-weight: bold;" data-key="sletBruger">Slet virksomhed</h2>
            </div>
            <form class="form-group text-left sletBrugerForm" onsubmit="return false">
                <div>
                    <div class="formError float-left" id="virk-error"></div><br>
                </div>
                <div class="row col-12">
                    <label for="email" class="col-form-label">Email</label>
                </div>
                <div class="form-group row">
                    <div class="col-12">
                        <input name="email" type="text" id="virksomhedSletEmailInput" class="form-control" placeholder="example@edu.easj.dk" style="background-color: #f7f7f7;" required oninvalid="this.setCustomValidity('Feltet må ikke være tomt')" oninput="this.setCustomValidity('')">
                    </div> 
                </div>
                <input  class="gulKnap rounded" onclick="submitSletVirksomhed()" type="submit" data-key="slet" value="Slet">
                <input id="submit_handle_virk" type="submit" style="display: none">
            </form>
        </div>
    </div>
</div>
<script>
        var backendIsProcessing = false;
        function submitSletStudent() {
            $('#submit_handle_student').click();
            //kun hvis alle felter er udfylte sender vi videre til backend validering
            if(document.getElementById("studentSletEmailInput").validity.valid){
                if(!backendIsProcessing){
                    backendIsProcessing = true;
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) { // hvis brugeren ikke er logget ind, så returnere kaldet undefined eller en email
                            let responseObject = JSON.parse(this.responseText)
                            console.log(responseObject);
                            if(responseObject.errorHappened){
                                document.getElementById('student-error').innerHTML = "Denne bruger findes ikke";
                                document.getElementById("student-error").classList.add('formError');
                                document.getElementById("student-error").classList.remove('formSucess');
                            } else {
                                document.getElementById('student-error').innerHTML = "Brugeren blev slettet";
                                document.getElementById("student-error").classList.remove('formError');
                                document.getElementById("student-error").classList.add('formSucess');
                            }
                            backendIsProcessing=false;
                        }
                    }
                    xhttp.open("POST", "/admin-funktioner/slet-bruger", true);
                    xhttp.setRequestHeader("Content-Type", "text/plain")
                    xhttp.send(JSON.stringify ({
                        email: document.getElementById('studentSletEmailInput').value,
                        type: "student"

                    }));
                }
            }
        };
        function submitSletVirksomhed() {
            $('#submit_handle_virksomhed').click();
            //kun hvis alle felter er udfylte sender vi videre til backend validering
            if(document.getElementById("virksomhedSletEmailInput").validity.valid){
                if(!backendIsProcessing){
                    backendIsProcessing = true;
                    var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function () {
                        if (this.readyState == 4 && this.status == 200) { // hvis brugeren ikke er logget ind, så returnere kaldet undefined eller en email
                            let responseObject = JSON.parse(this.responseText)
                            console.log(responseObject);
                            if(responseObject.errorHappened){
                                document.getElementById('virk-error').innerHTML = "Denne bruger findes ikke";
                                document.getElementById("virk-error").classList.add('formError');
                                document.getElementById("virk-error").classList.remove('formSucess');
                            } else {
                                document.getElementById('virk-error').innerHTML = "Brugeren blev slettet";
                                document.getElementById("virk-error").classList.remove('formError');
                                document.getElementById("virk-error").classList.add('formSucess');
                            }
                            backendIsProcessing=false;
                        }
                    }
                    xhttp.open("POST", "/admin-funktioner/slet-bruger", true);
                    xhttp.setRequestHeader("Content-Type", "text/plain")
                    xhttp.send(JSON.stringify ({
                        email: document.getElementById('virksomhedSletEmailInput').value,
                        type: "virksomhed"
                    }));
                }
            }
        };
    </script>
